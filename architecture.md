# 屏幕录制应用架构设计

## 整体架构

本应用采用Electron框架，结合Node.js和Vue 3技术栈，实现跨平台的桌面屏幕录制功能。整体架构分为以下几个主要部分：

### 1. 主进程 (Main Process)

主进程负责应用的生命周期管理、窗口创建、系统API调用等核心功能：

- 应用初始化与配置管理
- 主窗口和悬浮窗的创建与管理
- 全局快捷键注册与监听
- 屏幕录制核心功能实现（基于node-screenshots）
- 文件系统操作（保存录制文件、读取配置等）
- 哈希计算功能实现
- 进程间通信管理

### 2. 渲染进程 (Renderer Process)

渲染进程负责用户界面渲染和交互处理：

- 主界面（基于Vue 3实现）
  - 录制参数设置界面
  - 录制控制界面
  - 文件管理界面
- 悬浮窗界面
  - 录制时长显示
  - 文件大小实时更新
  - 快捷操作按钮

### 3. 进程间通信 (IPC)

通过Electron的IPC机制实现主进程和渲染进程之间的通信：

- 渲染进程向主进程：
  - 发送录制参数配置
  - 发送开始/暂停/停止录制指令
  - 请求文件保存路径选择
- 主进程向渲染进程：
  - 发送录制状态更新
  - 发送录制时长和文件大小信息
  - 发送录制完成和哈希计算结果

## 模块设计

### 1. 录屏核心模块 (ScreenRecorder)

负责实现屏幕录制的核心功能：

```
ScreenRecorder
├── 初始化录制参数（帧率、保存路径、音频设置）
├── 开始录制方法
├── 暂停录制方法
├── 停止录制方法
├── 获取录制状态方法
└── 事件发射器（录制状态变化、时长更新、文件大小更新）
```

### 2. 快捷键模块 (HotKeyManager)

负责全局快捷键的注册和监听：

```
HotKeyManager
├── 注册快捷键方法
├── 注销快捷键方法
└── 快捷键事件处理
```

### 3. 悬浮窗模块 (FloatingWindow)

负责创建和管理录制过程中的悬浮窗：

```
FloatingWindow
├── 创建悬浮窗方法
├── 更新悬浮窗内容方法（时长、文件大小）
├── 设置悬浮窗位置方法
└── 关闭悬浮窗方法
```

### 4. 文件处理模块 (FileManager)

负责文件保存和哈希计算：

```
FileManager
├── 选择保存路径方法
├── 保存录制文件方法
├── 计算文件哈希方法
└── 获取文件大小方法
```

### 5. 配置管理模块 (ConfigManager)

负责应用配置的读取和保存：

```
ConfigManager
├── 读取配置方法
├── 保存配置方法
└── 重置配置方法
```

## 数据流设计

1. **录制参数流**：用户界面 → 渲染进程 → IPC → 主进程 → ScreenRecorder模块
2. **录制控制流**：用户界面/快捷键 → 渲染进程/主进程 → ScreenRecorder模块
3. **状态更新流**：ScreenRecorder模块 → 主进程 → IPC → 渲染进程 → 用户界面/悬浮窗
4. **文件处理流**：ScreenRecorder模块 → FileManager模块 → 主进程 → IPC → 渲染进程 → 用户界面

## 技术选型详情

1. **Electron**：提供跨平台桌面应用开发框架
2. **Vue 3**：前端UI框架，采用Composition API开发模式
3. **node-screenshots**：提供屏幕录制核心功能
4. **electron-store**：持久化配置存储
5. **crypto**：用于文件哈希计算
6. **ffmpeg-static**：处理音频录制和视频合成（如需要）

## UI流程设计

1. **主界面**：
   - 录制参数设置区（帧率选择、保存路径选择、音频开关）
   - 快捷键设置区
   - 录制控制区（开始、暂停、停止按钮）
   - 录制历史区（可选）

2. **悬浮窗**：
   - 录制时长显示
   - 文件大小显示
   - 快捷控制按钮（暂停/继续、停止）
   - 可拖动设计

## 注意事项与优化点

1. **性能优化**：
   - 使用Worker进程处理哈希计算等CPU密集型任务
   - 优化录制过程中的内存使用

2. **用户体验**：
   - 提供合理的默认配置
   - 记住用户上次的设置
   - 提供简洁直观的UI

3. **错误处理**：
   - 完善的错误捕获和恢复机制
   - 用户友好的错误提示
